<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>街霸6风格图标生成器 - TFA版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        streetfighter: { red: '#e63946', blue: '#1d3557', yellow: '#f1faee', light: '#a8dadc', dark: '#1d3557' }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .control-panel {
                @apply bg-gray-800 text-white p-4 rounded-lg shadow-lg;
            }

            .streetfighter-bg {
                background: linear-gradient(145deg, #2d2d2d, #1a1a1a);
                border: 2px solid #444;
                box-shadow: 5px 5px 0 #000;
            }

            .bg-option {
                @apply relative p-2 rounded cursor-pointer transition-all duration-200 border border-transparent;
            }

                .bg-option:hover {
                    @apply bg-gray-700;
                }

                .bg-option.active {
                    @apply bg-streetfighter-red/30 border-streetfighter-red;
                }

            .char-canvas {
                width: 100% !important;
                height: auto !important;
                display: block;
                border-radius: 4px;
            }

            .preset-option {
                @apply relative p-4 rounded cursor-pointer transition-all duration-200 border border-gray-700 hover:border-streetfighter-light flex flex-col items-center justify-center;
            }

                .preset-option.active {
                    @apply bg-streetfighter-red/20 border-streetfighter-red;
                }

            .preset-label {
                @apply font-medium mt-2 text-sm;
            }

            ::-webkit-scrollbar {
                width: 8px;
                height: 8px;
            }

            ::-webkit-scrollbar-track {
                background: #1a1a1a;
            }

            ::-webkit-scrollbar-thumb {
                background: #555;
                border-radius: 4px;
            }

                ::-webkit-scrollbar-thumb:hover {
                    background: #e63946;
                }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <header class="text-center mb-8">
            <h1 class="text-[clamp(1.8rem,5vw,2.8rem)] font-bold mb-1 text-streetfighter-light">
                <span class="text-streetfighter-red">街霸6</span>操作风格图标生成器
            </h1>
            <p class="text-gray-400 text-sm italic">made by 天格会整活部</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <div class="lg:col-span-1">
                <div class="control-panel flex flex-col gap-6">
                    <div class="flex justify-center py-2 border-b border-gray-700">
                        <img src="/img/logo_pixel.png" alt="TFA Logo" class="h-16 object-contain opacity-90 hover:opacity-100 transition-opacity" onerror="this.src='https://placehold.co/200x80/1d3557/a8dadc?text=TFA+LOGO'">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-300">输入文字 (支持换行/空格)</label>
                        <textarea id="textInput" maxlength="100" rows="4"
                                  class="w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-streetfighter-red resize-none font-bold"
                                  placeholder="在此输入文字...">街霸6&#13;图标生成</textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-300">风格方案</label>
                        <div class="grid grid-cols-3 gap-2">
                            <div class="preset-option active" data-preset="classic"><i class="fa fa-star text-streetfighter-red"></i><span class="preset-label">经典</span></div>
                            <div class="preset-option" data-preset="modern"><i class="fa fa-bolt text-streetfighter-light"></i><span class="preset-label">现代</span></div>
                            <div class="preset-option" data-preset="dynamic"><i class="fa fa-tint text-streetfighter-blue"></i><span class="preset-label">动感</span></div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-300">背景图</label>
                        <div class="grid grid-cols-3 gap-2">
                            <div class="bg-option active" data-bg="bg1"><div class="w-full h-10 bg-cover bg-center rounded" style="background-image: url('/img/icon_c.png');"></div></div>
                            <div class="bg-option" data-bg="bg2"><div class="w-full h-10 bg-cover bg-center rounded" style="background-image: url('/img/icon_m.png');"></div></div>
                            <div class="bg-option" data-bg="bg3"><div class="w-full h-10 bg-cover bg-center rounded" style="background-image: url('/img/icon_d.png');"></div></div>
                        </div>
                    </div>

                    <div class="flex flex-col gap-3 pt-2">
                        <button id="downloadBtn" class="w-full bg-streetfighter-red hover:bg-red-600 text-white font-bold py-3 rounded transition flex items-center justify-center gap-2 shadow-lg">
                            <i class="fa fa-download"></i> 高清大图 (100%)
                        </button>
                        <button id="downloadSmallBtn" class="w-full bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 rounded transition flex items-center justify-center gap-2">
                            <i class="fa fa-file-image-o"></i> 分享小图 (25%)
                        </button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-3 flex flex-col h-full">
                <div class="streetfighter-bg p-4 md:p-6 rounded-lg flex-grow flex flex-col min-h-[500px]">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-streetfighter-light font-bold">实时预览预览 (1:1 比例排版)</h3>
                    </div>

                    <div id="previewContainer" class="bg-black/40 p-4 rounded-lg flex-grow overflow-auto">
                        <div id="gridContainer" class="flex flex-col gap-2"></div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-12 text-center text-gray-500 text-sm">
            <p>© 2026 天津格斗游戏同好会 | 天格会整活部</p>
        </footer>
    </div>

    <script>
        // --- 此处为您要求的预制方案配置，您可以直接在此修改参数 ---
        const presets = {
            classic: {
                textColor: '#EAAAFF',
                innerStrokeColor: '#FFFFFF',
                innerStrokeSize: 8,
                outerStrokeColor1: '#FC62FE',
                outerStrokeColor2: '#710BF1',
                outerStrokeSize: 13,
                glowStrength: 80,
                glowColor: '#C158FE',
                glowIntensity: 85,
                glowLayers: 4,
                fontSize: 275,
                fontWeight: 650,
                splitPosition: 60,
                fontFamily: 'Arial',
                fontCompensation: 30, // 垂直校准补偿
                verticalOffset: 0,
                bgImage: 'bg1'
            },
            modern: {
                textColor: '#fed9ac',
                innerStrokeColor: '#FFFFFF',
                innerStrokeSize: 8,
                outerStrokeColor1: '#FFD829',
                outerStrokeColor2: '#F00000',
                outerStrokeSize: 13,
                glowStrength: 90,
                glowColor: '#FF4000',
                glowIntensity: 100,
                glowLayers: 5,
                fontSize: 275,
                fontWeight: 650,
                splitPosition: 60,
                fontFamily: 'Arial',
                fontCompensation: 30,
                verticalOffset: 0,
                bgImage: 'bg2'
            },
            dynamic: {
                textColor: '#b9d1f7',
                innerStrokeColor: '#FFFFFF',
                innerStrokeSize: 8,
                outerStrokeColor1: '#8da1f4',
                outerStrokeColor2: '#3ea1cf',
                outerStrokeSize: 13,
                glowStrength: 80,
                glowColor: '#1c97f0',
                glowIntensity: 85,
                glowLayers: 4,
                fontSize: 275,
                fontWeight: 650,
                splitPosition: 60,
                fontFamily: 'Arial',
                fontCompensation: 30,
                verticalOffset: 0,
                bgImage: 'bg3'
            }
        };

        const textInput = document.getElementById('textInput');
        const gridContainer = document.getElementById('gridContainer');
        const downloadBtn = document.getElementById('downloadBtn');
        const downloadSmallBtn = document.getElementById('downloadSmallBtn');
        const presetOptions = document.querySelectorAll('.preset-option');
        const bgOptions = document.querySelectorAll('.bg-option');

        const backgroundImages = { bg1: '/img/icon_c.png', bg2: '/img/icon_m.png', bg3: '/img/icon_d.png' };
        let currentPreset = 'classic';
        let selectedBg = 'bg1';
        let bgImagesLoaded = false;
        const bgImageElements = {};
        const imageRatios = { bg1: 1, bg2: 1, bg3: 1 };

        function loadBackgroundImages() {
            let loadedCount = 0;
            const keys = Object.keys(backgroundImages);
            keys.forEach(key => {
                const img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = () => {
                    imageRatios[key] = img.height / img.width;
                    bgImageElements[key] = img;
                    loadedCount++;
                    if (loadedCount === keys.length) { bgImagesLoaded = true; updatePreview(); }
                };
                img.src = backgroundImages[key];
            });
        }

        // 侵蚀算法：用于精确复刻原版内描边逻辑
        function erodeImage(imageData, radius) {
            const width = imageData.width, height = imageData.height, data = imageData.data;
            const result = new ImageData(new Uint8ClampedArray(data), width, height);
            const resultData = result.data;
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const idx = (y * width + x) * 4;
                    if (data[idx + 3] > 128) {
                        let hasTransparentNeighbor = false;
                        checkLoop: for (let dy = -radius; dy <= radius; dy++) {
                            for (let dx = -radius; dx <= radius; dx++) {
                                if (dx * dx + dy * dy <= radius * radius) {
                                    const nx = x + dx, ny = y + dy;
                                    if (nx >= 0 && nx < width && ny >= 0 && ny < height) {
                                        if (data[(ny * width + nx) * 4 + 3] < 128) { hasTransparentNeighbor = true; break checkLoop; }
                                    }
                                }
                            }
                        }
                        if (hasTransparentNeighbor) resultData[idx + 3] = 0;
                    }
                }
            }
            return result;
        }

        function generateSingleCharCanvas(char, width, height) {
            const canvas = document.createElement('canvas');
            canvas.width = width; canvas.height = height;
            const ctx = canvas.getContext('2d');
            const config = presets[currentPreset];
            const x = width / 2, y = height / 2 + (config.verticalOffset || 0) + (config.fontCompensation || 0);

            // 1. 绘制底图
            if (bgImageElements[selectedBg]) ctx.drawImage(bgImageElements[selectedBg], 0, 0, width, height);
            if (!char.trim() || char === '\n') return canvas;

            ctx.font = `${config.fontWeight} ${config.fontSize}px ${config.fontFamily}, Arial, sans-serif`;
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle';

            // 2. 绘制发光 (Glow Layers)
            if (config.glowStrength > 0) {
                const intensityStep = (config.glowIntensity / 100) / config.glowLayers;
                for (let i = 0; i < config.glowLayers; i++) {
                    const layerSize = config.glowStrength * (1 - i / (config.glowLayers * 2));
                    ctx.save();
                    ctx.fillStyle = config.glowColor; ctx.shadowColor = config.glowColor; ctx.shadowBlur = layerSize;
                    ctx.globalAlpha = intensityStep * (config.glowLayers - i);
                    ctx.fillText(char, x, y); ctx.restore();
                }
            }

            // 3. 绘制外描边 (Outer Stroke)
            ctx.save();
            const grad = ctx.createLinearGradient(x, y - config.fontSize / 2, x, y + config.fontSize / 2);
            grad.addColorStop(0, config.outerStrokeColor1); grad.addColorStop(1, config.outerStrokeColor2);
            ctx.strokeStyle = grad; ctx.lineWidth = config.outerStrokeSize; ctx.lineJoin = 'round';
            ctx.strokeText(char, x, y); ctx.restore();

            // 4. 绘制内描边层 (核心逻辑：隔离计算)
            ctx.save(); ctx.fillStyle = config.innerStrokeColor; ctx.fillText(char, x, y); ctx.restore();

            // 创建侵蚀层
            const temp = document.createElement('canvas'); temp.width = width; temp.height = height;
            const tCtx = temp.getContext('2d');
            tCtx.font = ctx.font; tCtx.textAlign = 'center'; tCtx.textBaseline = 'middle';
            tCtx.fillText(char, x, y);
            const eroded = erodeImage(tCtx.getImageData(0, 0, width, height), config.innerStrokeSize);
            tCtx.clearRect(0, 0, width, height); tCtx.putImageData(eroded, 0, 0);

            // 创建分色层
            const split = document.createElement('canvas'); split.width = width; split.height = height;
            const sCtx = split.getContext('2d');
            sCtx.font = ctx.font; sCtx.textAlign = 'center'; sCtx.textBaseline = 'middle';
            const splitPos = y - config.fontSize * (config.splitPosition / 100);

            sCtx.save(); sCtx.beginPath(); sCtx.rect(0, 0, width, splitPos + config.fontSize / 2); sCtx.clip();
            sCtx.fillStyle = config.innerStrokeColor; sCtx.fillText(char, x, y); sCtx.restore();

            sCtx.save(); sCtx.beginPath(); sCtx.rect(0, splitPos + config.fontSize / 2, width, height); sCtx.clip();
            sCtx.fillStyle = config.textColor; sCtx.fillText(char, x, y); sCtx.restore();

            // 混合：内侵蚀效果
            tCtx.globalCompositeOperation = 'source-in'; tCtx.drawImage(split, 0, 0);
            ctx.drawImage(temp, 0, 0);

            return canvas;
        }

        function updatePreview() {
            if (!bgImagesLoaded) return;
            gridContainer.innerHTML = '';
            const lines = textInput.value.split('\n');
            const baseWidth = 400, ratio = imageRatios[selectedBg], baseHeight = Math.round(baseWidth * ratio);

            lines.forEach(line => {
                const rowDiv = document.createElement('div');
                rowDiv.className = "grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2 mb-2";
                const chars = line.split('');
                if (chars.length === 0) rowDiv.className = "h-10";

                chars.forEach(char => {
                    const charWrapper = document.createElement('div');
                    if (char === ' ') {
                        charWrapper.className = "aspect-square";
                    } else {
                        const canvas = generateSingleCharCanvas(char, baseWidth, baseHeight);
                        canvas.className = 'char-canvas';
                        charWrapper.appendChild(canvas);
                    }
                    rowDiv.appendChild(charWrapper);
                });
                gridContainer.appendChild(rowDiv);
            });
        }

        async function doDownload(scale = 1) {
            const lines = textInput.value.split('\n');
            const baseW = 400, ratio = imageRatios[selectedBg], baseH = Math.round(baseW * ratio), gap = 12;
            let maxChars = 0;
            lines.forEach(l => maxChars = Math.max(maxChars, l.length));
            if (maxChars === 0) return;

            const finalW = (maxChars * baseW + (maxChars - 1) * gap) * scale;
            const finalH = (lines.length * baseH + (lines.length - 1) * gap) * scale;

            const master = document.createElement('canvas');
            master.width = finalW; master.height = finalH;
            const mCtx = master.getContext('2d');
            mCtx.scale(scale, scale);

            lines.forEach((line, r) => {
                line.split('').forEach((char, c) => {
                    if (char !== ' ') {
                        const charCanvas = generateSingleCharCanvas(char, baseW, baseH);
                        mCtx.drawImage(charCanvas, c * (baseW + gap), r * (baseH + gap));
                    }
                });
            });

            const link = document.createElement('a');
            const fileName = textInput.value.trim().replace(/\n/g, '_').substring(0, 10) || 'icon';
            link.download = `tfaicon_${fileName}.png`;
            link.href = master.toDataURL('image/png');
            link.click();
        }

        // 切换风格逻辑（自动切换对应背景）
        function switchPreset(presetName) {
            currentPreset = presetName;
            const config = presets[presetName];

            // 自动更新背景图选择
            if (config.bgImage) {
                selectedBg = config.bgImage;
                bgOptions.forEach(opt => {
                    opt.classList.toggle('active', opt.dataset.bg === selectedBg);
                });
            }

            presetOptions.forEach(opt => opt.classList.toggle('active', opt.dataset.preset === presetName));
            updatePreview();
        }

        textInput.addEventListener('input', updatePreview);
        downloadBtn.addEventListener('click', () => doDownload(1));
        downloadSmallBtn.addEventListener('click', () => doDownload(0.25));

        presetOptions.forEach(opt => opt.addEventListener('click', () => switchPreset(opt.dataset.preset)));

        bgOptions.forEach(opt => opt.addEventListener('click', () => {
            selectedBg = opt.dataset.bg;
            bgOptions.forEach(o => o.classList.remove('active'));
            opt.classList.add('active');
            updatePreview();
        }));

        window.addEventListener('load', loadBackgroundImages);
    </script>
</body>
</html>